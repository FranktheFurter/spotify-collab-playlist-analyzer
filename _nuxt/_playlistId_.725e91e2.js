import{r as $,z as L,A as B,B as J,i as w,h as k,C as p,o as v,c as b,D as x,a as y,t as _,F as M,E as C,G as O,j,H as V,I as N,q as Q,J as q,K as W,L as X,M as Y,f as F,u as Z,k as K,m as ee,N as te,b as P}from"./entry.0724691d.js";const se=e=>{const t=$(null),{token:r,getAccessToken:s}=L(),i=async o=>{const n={method:"get",url:`https://api.spotify.com/v1/users/${e}`,headers:{Authorization:`Bearer ${o}`}};try{const u=await B(n);t.value=u.data}catch(u){console.error("Error getting user data",u)}};return(async()=>{r.value===""&&await s(),i(r.value)})(),{userData:t}},z=$([]),A=$(null),U=$([]),T=(e=null)=>{const{token:t,getAccessToken:r}=L(),s=async o=>{let n=0,u=null;do{const m={method:"get",url:`https://api.spotify.com/v1/playlists/${e}/tracks?offset=${n}`,headers:{Authorization:`Bearer ${o}`}};try{const g=await B(m);z.value.push(...g.data.items),u=g.data.total,n+=g.data.items.length}catch(g){console.error("Error getting tracks",g)}}while(n<u)},i=async o=>{const n={method:"get",url:`https://api.spotify.com/v1/playlists/${e}`,headers:{Authorization:`Bearer ${o}`}};try{const u=await B(n);A.value=u.data}catch(u){console.error("Error getting playlist information",u)}};return e&&(async()=>{z.value=[],A.value=[],U.value=[],t.value===""&&await r(),i(t.value),await s(t.value);const o=Array.from(new Set(z.value.map(n=>n.added_by.id)));for(let n of o){const{userData:u}=se(n);J(()=>u.value,m=>{m&&U.value.push(m)},{immediate:!0})}})(),{playlist:z,playlistInfo:A,usersData:U}},D=()=>{const{playlist:e,playlistInfo:t,usersData:r}=T(),s=()=>e.value.reduce((l,d)=>l+d.track.duration_ms,0),i=l=>{const d=r.value.find(c=>c.id===l);return d?d.display_name:""},a=l=>e.value.filter(d=>d.added_by.id===l).length,o=l=>e.value.filter(d=>d.added_by.id===l).reduce((d,c)=>d+c.track.duration_ms,0),n=l=>{const d=o(l),c=e.value.reduce((f,h)=>f+h.track.duration_ms,0);return d/c*100},u=l=>{const d=e.value.filter(f=>f.added_by.id===l);return d.length===0?0:d.reduce((f,h)=>f+h.track.popularity,0)/d.length},m=w(()=>{const l=e.value.reduce((f,h)=>(f[h.added_by.id]?f[h.added_by.id]+=1:f[h.added_by.id]=1,f),{});let d=null,c=0;for(const f in l)l[f]>c&&(c=l[f],d=f);return d}),g=w(()=>{const l=e.value.reduce((f,h)=>(f[h.added_by.id]?f[h.added_by.id]+=1:f[h.added_by.id]=1,f),{});let d=null,c=1/0;for(const f in l)l[f]<c&&(c=l[f],d=f);return d});return{getDisplayNameById:i,getTracksCountByUserId:a,getTotalTrackDurationByUserId:o,getTracksDurationInPercentageByUserId:n,getTotalPlaylistDuration:s,getAverageTrackPopularityByUserId:u,getUserIdWithMostTracks:m,getUserIdWithLeastTracks:g}},R=()=>({msToTime:t=>{if(typeof t!="number")return"00h 00m 00s";const r=Math.floor(t/1e3%60),s=Math.floor(t/(1e3*60)%60),i=Math.floor(t/(1e3*60*60)),a=o=>o<10?`0${o}`:o;return`${a(i)}h ${a(s)}m ${a(r)}s`}}),re={key:0,class:"container mx-auto w-100% flex flex-col items-center mt-24 gap-8"},oe=["src"],ie=k({__name:"PlaylistInfo",setup(e){const{playlist:t,playlistInfo:r,usersData:s}=T(),{getTotalPlaylistDuration:i}=D(),{msToTime:a}=R();return(o,n)=>p(r)?(v(),b("div",re,[p(r).images&&p(r).images.length>0?(v(),b("img",{key:0,src:p(r).images[0].url,alt:"Playlist cover image",width:"300",height:"300"},null,8,oe)):x("",!0),y("h1",null,_(p(r).name)+" "+_(p(a)(p(i)())),1),y("h2",null,_(p(r).description),1)])):x("",!0)}}),ae={key:0,class:"flex flex-col items-center gap-1 border-gray/20 border-solid border-rounded-xl p-4"},ne=["src"],ce={key:1,class:"w-60px h-60px bg-gray rounded-full"},le={class:"mt-2"},de={class:"opacity-80"},ue={class:"opacity-80"},fe={class:"opacity-80"},ge={class:"opacity-80"},me=k({__name:"UserPanel",props:{userData:Object},setup(e){const t=e,{getTotalTrackDurationByUserId:r,getTracksCountByUserId:s,getTracksDurationInPercentageByUserId:i,getAverageTrackPopularityByUserId:a}=D(),{msToTime:o}=R(),n=t.userData.id,u=s(n),m=i(n),g=r(n),l=a(n),d=w(()=>o(g));return(c,f)=>{var h,S;return e.userData?(v(),b("div",ae,[e.userData.images&&e.userData.images.length>0?(v(),b("img",{key:0,class:"rounded-full",src:e.userData.images[0].url,alt:"User profile image",width:"60",height:"60"},null,8,ne)):(v(),b("div",ce)),y("div",le,_(e.userData.display_name),1),y("div",de,_(p(u)),1),y("div",ue,_(p(d)),1),y("div",fe,_((h=p(m))==null?void 0:h.toFixed(2))+" % Playtime",1),y("div",ge,_((S=p(l))==null?void 0:S.toFixed(0))+" popularity",1)])):x("",!0)}}}),he=y("div",{class:"container mx-auto"},[y("h2",null,"Teilnehmer")],-1),pe={class:"container mx-auto grid grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-4 py-8"},ye={class:"container mx-auto"},ve=y("h2",null,"Awards:",-1),_e=y("h3",null,"Most Tracks:",-1),we=y("h3",null,"Least Tracks:",-1),be=k({__name:"Users",setup(e){const{usersData:t}=T(),{getDisplayNameById:r,getUserIdWithMostTracks:s,getUserIdWithLeastTracks:i}=D();return(a,o)=>{const n=me;return v(),b(M,null,[he,y("div",pe,[(v(!0),b(M,null,C(p(t),(u,m)=>(v(),O(n,{key:m,"user-data":u},null,8,["user-data"]))),128))]),y("div",ye,[ve,_e,y("p",null,_(p(s)?p(r)(p(s)):"No user found"),1),we,y("p",null,_(p(i)?p(r)(p(i)):"No user found"),1)])],64)}}});async function Ie(e,t){return await $e(t).catch(s=>(console.error("Failed to get image meta for "+t,s+""),{width:0,height:0,ratio:0}))}async function $e(e){if(typeof Image>"u")throw new TypeError("Image not supported");return new Promise((t,r)=>{const s=new Image;s.onload=()=>{const i={width:s.width,height:s.height,ratio:s.width/s.height};t(i)},s.onerror=i=>r(i),s.src=e})}function E(e){return t=>t?e[t]||t:e.missingValue}function ke({formatter:e,keyMap:t,joinWith:r="/",valueMap:s}={}){e||(e=(a,o)=>`${a}=${o}`),t&&typeof t!="function"&&(t=E(t));const i=s||{};return Object.keys(i).forEach(a=>{typeof i[a]!="function"&&(i[a]=E(i[a]))}),(a={})=>Object.entries(a).filter(([n,u])=>typeof u<"u").map(([n,u])=>{const m=i[n];return typeof m=="function"&&(u=m(a[n])),n=typeof t=="function"?t(n):n,e(n,u)}).join(r)}function I(e=""){if(typeof e=="number")return e;if(typeof e=="string"&&e.replace("px","").match(/^\d+$/g))return parseInt(e,10)}function xe(e){const t={options:e},r=(i,a={})=>H(t,i,a),s=(i,a={},o={})=>r(i,{...o,modifiers:q(a,o.modifiers||{})}).url;for(const i in e.presets)s[i]=(a,o,n)=>s(a,o,{...e.presets[i],...n});return s.options=e,s.getImage=r,s.getMeta=(i,a)=>Te(t,i,a),s.getSizes=(i,a)=>ze(t,i,a),t.$img=s,s}async function Te(e,t,r){const s=H(e,t,{...r});return typeof s.getMeta=="function"?await s.getMeta():await Ie(e,s.url)}function H(e,t,r){var m,g;if(typeof t!="string"||t==="")throw new TypeError(`input must be a string (received ${typeof t}: ${JSON.stringify(t)})`);if(t.startsWith("data:"))return{url:t};const{provider:s,defaults:i}=De(e,r.provider||e.options.provider),a=Se(e,r.preset);if(t=j(t)?t:V(t),!s.supportsAlias)for(const l in e.options.alias)t.startsWith(l)&&(t=N(e.options.alias[l],t.substr(l.length)));if(s.validateDomains&&j(t)){const l=Q(t).host;if(!e.options.domains.find(d=>d===l))return{url:t}}const o=q(r,a,i);o.modifiers={...o.modifiers};const n=o.modifiers.format;(m=o.modifiers)!=null&&m.width&&(o.modifiers.width=I(o.modifiers.width)),(g=o.modifiers)!=null&&g.height&&(o.modifiers.height=I(o.modifiers.height));const u=s.getImage(t,o,e);return u.format=u.format||n||"",u}function De(e,t){const r=e.options.providers[t];if(!r)throw new Error("Unknown provider: "+t);return r}function Se(e,t){if(!t)return{};if(!e.options.presets[t])throw new Error("Unknown preset: "+t);return e.options.presets[t]}function ze(e,t,r){var m,g;const s=I((m=r.modifiers)==null?void 0:m.width),i=I((g=r.modifiers)==null?void 0:g.height),a=s&&i?i/s:0,o=[],n={};if(typeof r.sizes=="string")for(const l of r.sizes.split(/[\s,]+/).filter(d=>d)){const d=l.split(":");d.length===2&&(n[d[0].trim()]=d[1].trim())}else Object.assign(n,r.sizes);for(const l in n){const d=e.options.screens&&e.options.screens[l]||parseInt(l);let c=String(n[l]);const f=c.endsWith("vw");if(!f&&/^\d+$/.test(c)&&(c=c+"px"),!f&&!c.endsWith("px"))continue;let h=parseInt(c);if(!d||!h)continue;f&&(h=Math.round(h/100*d));const S=a?Math.round(h*a):i;o.push({width:h,size:c,screenMaxWidth:d,media:`(max-width: ${d}px)`,src:e.$img(t,{...r.modifiers,width:h,height:S},r)})}o.sort((l,d)=>l.screenMaxWidth-d.screenMaxWidth);const u=o[o.length-1];return u&&(u.media=""),{sizes:o.map(l=>`${l.media?l.media+" ":""}${l.size}`).join(", "),srcset:o.map(l=>`${l.src} ${l.width}w`).join(", "),src:u==null?void 0:u.src}}const Pe=ke({keyMap:{format:"f",fit:"fit",width:"w",height:"h",resize:"s",quality:"q",background:"b"},joinWith:"&",formatter:(e,t)=>W(e)+"_"+W(t)}),Ae=(e,{modifiers:t={},baseURL:r}={},s)=>{t.width&&t.height&&(t.resize=`${t.width}x${t.height}`,delete t.width,delete t.height);const i=Pe(t)||"_";return r||(r=N(s.options.nuxt.baseURL,"/_ipx")),{url:N(r,i,X(e))}},Ue=!0,Be=!0,Me=Object.freeze(Object.defineProperty({__proto__:null,getImage:Ae,supportsAlias:Be,validateDomains:Ue},Symbol.toStringTag,{value:"Module"})),G={screens:{xs:320,sm:640,md:768,lg:1024,xl:1280,xxl:1536,"2xl":1536},presets:{},provider:"ipx",domains:[],alias:{}};G.providers={ipx:{provider:Me,defaults:void 0}};const Ne=()=>{const e=Y(),t=F();return t.$img||t._img||(t._img=xe({...G,nuxt:{baseURL:e.app.baseURL}}))},je={src:{type:String,required:!0},format:{type:String,default:void 0},quality:{type:[Number,String],default:void 0},background:{type:String,default:void 0},fit:{type:String,default:void 0},modifiers:{type:Object,default:void 0},preset:{type:String,default:void 0},provider:{type:String,default:void 0},sizes:{type:[Object,String],default:void 0},preload:{type:Boolean,default:void 0},width:{type:[String,Number],default:void 0},height:{type:[String,Number],default:void 0},alt:{type:String,default:void 0},referrerpolicy:{type:String,default:void 0},usemap:{type:String,default:void 0},longdesc:{type:String,default:void 0},ismap:{type:Boolean,default:void 0},loading:{type:String,default:void 0},crossorigin:{type:[Boolean,String],default:void 0,validator:e=>["anonymous","use-credentials","",!0,!1].includes(e)},decoding:{type:String,default:void 0,validator:e=>["async","auto","sync"].includes(e)}},We=e=>{const t=w(()=>({provider:e.provider,preset:e.preset})),r=w(()=>({width:I(e.width),height:I(e.height),alt:e.alt,referrerpolicy:e.referrerpolicy,usemap:e.usemap,longdesc:e.longdesc,ismap:e.ismap,crossorigin:e.crossorigin===!0?"anonymous":e.crossorigin||void 0,loading:e.loading,decoding:e.decoding})),s=w(()=>({...e.modifiers,width:I(e.width),height:I(e.height),format:e.format,quality:e.quality,background:e.background,fit:e.fit}));return{options:t,attrs:r,modifiers:s}},Ee={...je,placeholder:{type:[Boolean,String,Number,Array],default:void 0}},Le=k({name:"NuxtImg",props:Ee,emits:["load","error"],setup:(e,t)=>{const r=Ne(),s=We(e),i=$(!1),a=w(()=>r.getSizes(e.src,{...s.options.value,sizes:e.sizes,modifiers:{...s.modifiers.value,width:I(e.width),height:I(e.height)}})),o=w(()=>{const c={...s.attrs.value,"data-nuxt-img":""};return e.sizes&&(c.sizes=a.value.sizes,c.srcset=a.value.srcset),c}),n=w(()=>{let c=e.placeholder;if(c===""&&(c=!0),!c||i.value)return!1;if(typeof c=="string")return c;const f=Array.isArray(c)?c:typeof c=="number"?[c,c]:[10,10];return r(e.src,{...s.modifiers.value,width:f[0],height:f[1],quality:f[2]||50},s.options.value)}),u=w(()=>e.sizes?a.value.src:r(e.src,s.modifiers.value,s.options.value)),m=w(()=>n.value?n.value:u.value);if(e.preload){const c=Object.values(a.value).every(f=>f);Z({link:[{rel:"preload",as:"image",...c?{href:a.value.src,imagesizes:a.value.sizes,imagesrcset:a.value.srcset}:{href:m.value}}]})}const g=$(),d=F().isHydrating;return K(()=>{if(n.value){const c=new Image;c.src=u.value,c.onload=f=>{g.value&&(g.value.src=u.value),i.value=!0,t.emit("load",f)};return}g.value&&(g.value.complete&&d&&(g.value.getAttribute("data-error")?t.emit("error",new Event("error")):t.emit("load",new Event("load"))),g.value.onload=c=>{t.emit("load",c)},g.value.onerror=c=>{t.emit("error",c)})}),()=>ee("img",{ref:g,key:m.value,src:m.value,...o.value,...t.attrs})}}),Ce={key:0,class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2 md:gap-4 container mx-auto"},Oe={class:"px-2 text-white/80 text-xs backdrop-blur-2xl border-solid border-white/20 w-100% md:w-unset"},qe={class:"line-clamp-1"},Fe={class:"line-clamp-1"},Re=k({__name:"TrackList",setup(e){const{playlist:t}=T();D();const r=s=>s.map(i=>i.name).join(", ");return(s,i)=>{const a=Le;return p(t)?(v(),b("div",Ce,[(v(!0),b(M,null,C(p(t),(o,n)=>(v(),b("div",{key:n,class:"w-100% flex md:flex-col bg-opacity-10"},[o.track.album.images&&o.track.album.images[0]?(v(),O(a,{key:0,src:o.track.album.images[0].url,alt:"cover",loading:"lazy",class:"object-contain w-20 md:w-100% aspect-1/1"},null,8,["src"])):x("",!0),y("div",Oe,[y("p",qe,_(o.track.name),1),y("p",Fe,_(r(o.track.artists)),1)])]))),128))])):x("",!0)}}}),He={class:""},Ge={class:"py-4"},Ve=k({__name:"[playlistId]",setup(e){const r=te().params.playlistId;return T(r),D(),(s,i)=>{const a=ie,o=be,n=Re;return v(),b("div",null,[y("div",He,[P(a),P(o),y("div",Ge,[P(n)])])])}}});export{Ve as default};
